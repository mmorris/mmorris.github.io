
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>launchctl asuser - Matt Morris</title>
  <meta name="author" content="Matt Morris">

  
  <meta name="description" content="launchctl asuser: How to spawn a GUI process from a daemon on OS X.">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mmorris.github.io/2013/04/24/launchctl-asuser">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <style>@import url("/stylesheets/bigfoot-default.css");</style>
  <script type="text/javascript" src="/javascripts/libs/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="/javascripts/bigfoot.min.js"></script>
  <script type="text/javascript">
    $.bigfoot({
      actionOriginalFN: "hide",
      activateOnHover: "true",
      deleteOnUnhover: "true",
      hoverDelay: "500"
    });
</script>
  <link href="/atom.xml" rel="alternate" title="Matt Morris" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28835327-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  
    <h2><a href="/">M</a></h2>
  
  <h1>Matt Morris</h1>
</hgroup>

</header>
  <nav role="navigation">
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="http://bit.ly/101wqfK">Support</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">launchctl asuser</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-24T23:54:44-04:00" pubdate data-updated="true">Apr 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man8/launchd.8.html">launchd</a> provides many ways to configure when and under what conditions a job is started. You can define agents that run for each user, or daemons that run as root outside of a GUI context.</p>

<p>The launchctl command is a convenient way to interface with launchd. Recently I came across a command in the <a href="http://www.opensource.apple.com/source/launchd/launchd-442.26.2/support/launchctl.c">launchctl source code</a> that is not documented in the launchctl man page. The &lsquo;asuser&rsquo; command can apparently be used to &ldquo;Execute a subcommand in the given user&rsquo;s context.&rdquo; This would mean that you could use this from a Launch Daemon to spawn a GUI process for a given user, which could be very useful in certain circumstances.</p>

<p>A quick glance at the code and this looks to be the case. It gets the root bootstrap port, looks up the per user mach port for the given UID, sets the bootstrap port for the current task, set some environment, and then does a fork/exec/waitpid.</p>

<p>Sure enough, if you ssh to a mac as root, you can spawn GUI applications into other users&#8217; consoles. I was even able to run Grab.app and capture images of the user&rsquo;s desktop. Without the asuser command, you get nasty errors like &ldquo;RegisterApplication(), FAILED TO establish the default connection to the WindowServer, CGSDefaultConnection() is NULL.&rdquo;</p>

<p>One days soon I&rsquo;d like to resurrect my <a href="https://github.com/mmorris/Launchctl-API">Launchctl API</a> project and add a few more commands, including this one.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (Matt Morris)" rel="author">Matt Morris</a></span></span>

      








  


<time datetime="2013-04-24T23:54:44-04:00" pubdate data-updated="true">Apr 24<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/categories/os/'>OS</a>, <a class='category' href='/categories/x/'>X</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2013/04/20/in-lieu-of-ads/" title="Previous Post: In Lieu of Ads">&laquo; In Lieu of Ads</a>
      
      
        <a class="basic-alignment right" href="/2013/04/27/on-pointless-check-ins/" title="next Post: On Pointless Check-Ins">On Pointless Check-Ins &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Matt Morris -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  













</body>
</html>
