<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: OS | Matt Morris]]></title>
  <link href="http://mmorris.github.io/categories/os/atom.xml" rel="self"/>
  <link href="http://mmorris.github.io/"/>
  <updated>2014-03-11T11:10:52-04:00</updated>
  <id>http://mmorris.github.io/</id>
  <author>
    <name><![CDATA[Matt Morris]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[launchctl asuser]]></title>
    <link href="http://mmorris.github.io/2013/04/24/launchctl-asuser/"/>
    <updated>2013-04-24T23:54:44-04:00</updated>
    <id>http://mmorris.github.io/2013/04/24/launchctl-asuser</id>
    <content type="html"><![CDATA[<p><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man8/launchd.8.html">launchd</a> provides many ways to configure when and under what conditions a job is started. You can define agents that run for each user, or daemons that run as root outside of a GUI context.</p>

<p>The launchctl command is a convenient way to interface with launchd. Recently I came across a command in the <a href="http://www.opensource.apple.com/source/launchd/launchd-442.26.2/support/launchctl.c">launchctl source code</a> that is not documented in the launchctl man page. The &lsquo;asuser&rsquo; command can apparently be used to &ldquo;Execute a subcommand in the given user&rsquo;s context.&rdquo; This would mean that you could use this from a Launch Daemon to spawn a GUI process for a given user, which could be very useful in certain circumstances.</p>

<p>A quick glance at the code and this looks to be the case. It gets the root bootstrap port, looks up the per user mach port for the given UID, sets the bootstrap port for the current task, set some environment, and then does a fork/exec/waitpid.</p>

<p>Sure enough, if you ssh to a mac as root, you can spawn GUI applications into other users' consoles. I was even able to run Grab.app and capture images of the user&rsquo;s desktop. Without the asuser command, you get nasty errors like &ldquo;RegisterApplication(), FAILED TO establish the default connection to the WindowServer, CGSDefaultConnection() is NULL.&rdquo;</p>

<p>One days soon I&rsquo;d like to resurrect my <a href="https://github.com/mmorris/Launchctl-API">Launchctl API</a> project and add a few more commands, including this one.</p>
]]></content>
  </entry>
  
</feed>
