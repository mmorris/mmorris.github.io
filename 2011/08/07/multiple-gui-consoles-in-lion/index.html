
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Multiple GUI Consoles in Lion - Matt Morris</title>
  <meta name="author" content="Matt Morris">

  
  <meta name="description" content="Fast User Switching has been around for some time. It was introduced to the Mac with the release of Mac OS 10.3 (Panther). This allows multiple users &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mmorris.github.io/2011/08/07/multiple-gui-consoles-in-lion">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <style>@import url("/stylesheets/bigfoot-default.css");</style>
  <script type="text/javascript" src="/javascripts/libs/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="/javascripts/bigfoot.min.js"></script>
  <script type="text/javascript">
    $.bigfoot({
      actionOriginalFN: "hide",
      activateOnHover: "true",
      deleteOnUnhover: "true",
      hoverDelay: "500"
    });
</script>
  <link href="/atom.xml" rel="alternate" title="Matt Morris" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28835327-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  
    <h2><a href="/">M</a></h2>
  
  <h1>Matt Morris</h1>
</hgroup>

</header>
  <nav role="navigation">
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="http://bit.ly/101wqfK">Support</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Multiple GUI Consoles in Lion</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-07T21:53:00-04:00" pubdate data-updated="true">Aug 7<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Fast User Switching has been around for some time. It was introduced to the Mac with the release of Mac OS 10.3 (Panther). This allows multiple users to be logged into the machine at the same time. Even with the ability to have multiple users, only one user could be in control of the screen in any given moment.</p>

<!--more-->


<p>If you were ssh’ed into a machine and wanted to tell who was logged in at that moment, you could just check the owner of /dev/console.</p>

<p>One major side effect of this is that you couldn’t use VNC or Apple’s screen sharing client to connect to your computer and access your desktop and applications if, for example, your spouse is at home logged into her account.</p>

<p>So, one of my favorite new features in Lion has to be per-user screen sharing.</p>

<blockquote><p>You can remotely log in to a Mac with any user account on that computer and control it, without interrupting someone else who might be using the computer under a different login.</p></blockquote>


<p>It is now possible to remotely view and control the GUI Console for one user while another is logged into the computer using the physical screen and mouse. You can test this by running the following screen capture code in the manner described below.</p>

<ol>
<li>Compile the above code and produce binary ‘foo.’</li>
<li>In Terminal, sleep 10; ./foo</li>
<li>In less than 10 seconds, fast user switch to another user account.</li>
<li>Watch for the image to appear in /tmp/.</li>
<li>Return to the first user account.</li>
</ol>


<p>On Lion, the resulting image is of the 1st user’s GUI console, even though /dev/console is owned by the 2nd user at the time.</p>

<p>On Snow Leopard, this code will crash unless you run it in the same Mac bootstrap namespace as the current owner of /dev/console. If you do that, it will produce an image of what’s currently showing on the screen.</p>

<p>Although Apple has already built this into its screen sharing application, many of the the APIs available to 3rd party developers haven’t quite caught up. This <a href="https://developer.apple.com/library/mac/#qa/qa1133/_index.html">technote</a> has the following to say about the System Configuration Framework,</p>

<blockquote><p>It assumes that the computer has a single GUI console. While that’s true currently, it may not be true forever. If you use this technique you will have to change your code if this situation changes. It has no way of indicating that multiple users are logged in. It has no way of indicating that a user is logged in but has switched to the login window. Because of these issues, routines like SCDynamicStoreCopyConsoleUser exist only for compatibility purposes. It’s likely that they will be formally deprecated in a future version of Mac OS X.</p></blockquote>


<p>So this framework certainly isn’t up to date on the current state of affairs. /dev/console can probably still be trusted to indicate which GUi session is currently showing on the physical display, but what about the rest? How well does OpenGL cope with all of this?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (Matt Morris)" rel="author">Matt Morris</a></span></span>

      








  


<time datetime="2011-08-07T21:53:00-04:00" pubdate data-updated="true">Aug 7<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/categories/mac/'>Mac</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2011/07/29/thanks-iceland/" title="Previous Post: Thanks, Iceland">&laquo; Thanks, Iceland</a>
      
      
        <a class="basic-alignment right" href="/2011/08/13/launchctl-api-part-1-bsexec/" title="next Post: Launchctl API Part 1:bsexec">Launchctl API Part 1:bsexec &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Matt Morris -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  













</body>
</html>
